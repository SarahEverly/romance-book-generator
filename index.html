<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kindle Unlimited Romance Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;900&display=swap');
      body {
        font-family: 'Inter', sans-serif;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/javascript">
        const { useState } = React;
        const { Heart, Upload } = lucide;

        function App() {
            const [books, setBooks] = useState([]);
            const [currentBook, setCurrentBook] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) {
                    return;
                }

                setLoading(true);
                setError(null);
                setBooks([]);
                setCurrentBook(null);

                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true,
                    complete: (results) => {
                        if (results.errors.length > 0) {
                            console.error("CSV Parsing Errors:", results.errors);
                            setError("Failed to parse the CSV file. Please check the format.");
                            setLoading(false);
                            return;
                        }

                        const formattedBooks = results.data.map(book => ({
                            ...book,
                            tropes: book.tropes ? String(book.tropes).split(',').map(t => t.trim()) : [],
                            affiliateLink: book.affiliateLink || "https://www.amazon.com/kindle-dbs/hz/subscribe/ku/?ref_=dbs_f_kud_kd_ku_sub_romance_dbs_romance_p"
                        }));

                        setBooks(formattedBooks);
                        if (formattedBooks.length > 0) {
                            setCurrentBook(formattedBooks[0]);
                        }
                        setLoading(false);
                    },
                    error: (err) => {
                        console.error("CSV Parsing Error:", err);
                        setError("An error occurred while parsing the CSV file.");
                        setLoading(false);
                    },
                });
            };

            const generateNewBook = () => {
                if (books.length === 0) {
                    return;
                }
                const randomIndex = Math.floor(Math.random() * books.length);
                setCurrentBook(books[randomIndex]);
            };

            // Using React.createElement instead of JSX
            return React.createElement('div', { className: "min-h-screen flex items-center justify-center bg-gray-100 p-4 font-inter" },
                React.createElement('div', { className: "bg-white shadow-xl rounded-2xl p-8 max-w-xl w-full text-center transform transition-all duration-300" },
                    React.createElement('h1', { className: "text-4xl font-bold text-pink-600 mb-6 flex items-center justify-center" },
                        React.createElement(Heart, { className: "mr-2", size: 36 }),
                        " Romance Book List"
                    ),

                    React.createElement('div', { className: "border-2 border-dashed border-gray-300 rounded-xl p-6 mb-8 hover:border-pink-400 transition-colors duration-200" },
                        React.createElement('label', { htmlFor: "csv-upload", className: "cursor-pointer" },
                            React.createElement('div', { className: "flex flex-col items-center justify-center text-gray-500" },
                                React.createElement(Upload, { size: 48, className: "mb-2" }),
                                React.createElement('p', { className: "text-lg font-semibold" }, "Upload your CSV book list"),
                                React.createElement('p', { className: "text-sm" }, "Columns: `title`, `author`, `coverImage`, `tropes`, `affiliateLink`")
                            ),
                            React.createElement('input', {
                                id: "csv-upload",
                                type: "file",
                                accept: ".csv",
                                className: "hidden",
                                onChange: handleFileUpload
                            })
                        )
                    ),

                    loading && React.createElement('div', { className: "mt-6 text-pink-500 font-medium" }, "Loading books..."),

                    error && React.createElement('div', { className: "mt-6 text-red-500 font-medium" }, error),

                    currentBook && React.createElement('div', { className: "space-y-6" },
                        React.createElement('div', { className: "relative w-48 h-72 mx-auto rounded-lg shadow-lg overflow-hidden" },
                            React.createElement('img', {
                                src: currentBook.coverImage,
                                alt: `${currentBook.title} book cover`,
                                className: "w-full h-full object-cover transition-transform duration-300 hover:scale-110"
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('h2', { className: "text-3xl font-extrabold text-gray-900 leading-tight" }, currentBook.title),
                            React.createElement('p', { className: "text-xl text-gray-600 mt-1 font-medium italic" }, `by ${currentBook.author}`)
                        ),
                        React.createElement('div', { className: "text-left bg-pink-50 p-4 rounded-lg shadow-inner" },
                            React.createElement('h3', { className: "text-lg font-bold text-pink-700 mb-2" }, "Tropes:"),
                            React.createElement('ul', { className: "list-disc list-inside text-gray-700" },
                                currentBook.tropes.map((trope, index) => (
                                    React.createElement('li', { key: index }, trope)
                                ))
                            )
                        ),
                        React.createElement('a', {
                            href: currentBook.affiliateLink,
                            target: "_blank",
                            rel: "noopener noreferrer",
                            className: "inline-block w-full py-3 px-6 rounded-full font-semibold text-lg bg-pink-700 text-white shadow-lg transition-all duration-300 hover:bg-pink-800 hover:shadow-xl transform hover:-translate-y-1"
                        }, "Read/Purchase on Kindle Unlimited")
                    ),

                    books.length > 0 && React.createElement('div', { className: "mt-8" },
                        React.createElement('button', {
                            onClick: generateNewBook,
                            className: "w-full py-3 px-6 rounded-full font-semibold text-lg transition-all duration-300 bg-pink-500 text-white shadow-lg hover:bg-pink-600 hover:shadow-xl transform hover:-translate-y-1"
                        }, "Get a New Recommendation")
                    )
                )
            );
        }

        document.addEventListener('DOMContentLoaded', () => {
            const rootElement = document.getElementById('root');
            if (rootElement) {
                ReactDOM.render(React.createElement(App), rootElement);
            }
        });
    </script>
</body>
</html>
